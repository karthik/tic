<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced usage • tic</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced usage">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tic</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.13.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tic-advantages.html">tic advantages</a>
    </li>
    <li>
      <a href="../articles/tic-usethis-travis.html">tic, travis and usethis</a>
    </li>
    <li>
      <a href="../articles/build-lifecycle.html">Build lifecycle</a>
    </li>
    <li>
      <a href="../articles/advanced.html">Advanced usage</a>
    </li>
    <li>
      <a href="../articles/custom_steps.html">Dev - custom steps</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropenscilabs/tic">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Advanced usage</h1>
                        <h4 class="author">Patrick Schratz, Kirill Müller</h4>
            
            <h4 class="date">2018-08-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropenscilabs/tic/blob/master/vignettes/advanced.Rmd"><code>vignettes/advanced.Rmd</code></a></small>
      <div class="hidden name"><code>advanced.Rmd</code></div>

    </div>

    
    
<div id="deployment" class="section level1">
<h1 class="hasAnchor">
<a href="#deployment" class="anchor"></a>Deployment</h1>
<div id="pkgdown-deployment" class="section level2">
<h2 class="hasAnchor">
<a href="#pkgdown-deployment" class="anchor"></a>pkgdown deployment</h2>
<p>You may optionally set the deployment branch to <code>gh-pages</code> and then change the branch serving your site in the Github repo settings (change it to <code>gh-pages</code>). <code>pkgdown</code> sites of an R package can either be served from the <code>/docs</code> directory of the <code>master</code> branch of from the root of the <code>gh-pages</code> branch. Using the latter option has the advantage to not have all the automatic commits from Travis in the <code>master</code> branch -&gt; the <code>pkgdown</code> site will be “silently” updated in the background. Simply set the <code>branch</code> argument in <code><a href="../reference/step_push_deploy.html">step_push_deploy()</a></code> to <code>gh-pages</code>.</p>
<p>Also, make sure to set <code>orphan = TRUE</code>. This causes the branch to only consist of the commit that was pushed to Github (which is what you want for the <code>gh-pages</code> branch). Don’t worry, this option won’t work when pushing to the current branch, so no worries about accidentally deleting your whole repo ;-) Now, <code><a href="../reference/step_push_deploy.html">step_push_deploy(path = "docs", branch = "gh-pages", orphan = TRUE)</a></code> will deploy the files generated by <code><a href="../reference/step_build_pkgdown.html">step_build_pkgdown()</a></code> to the <code>gh-pages</code> branch of your repo.</p>
<p>If you are running a build matrix or build stages on Travis, you only want to run the <code>pkgdown</code> building and deployment once. However, sometimes you want to deploy multiple files in different stages. You can restrict on which stage/job a task is executed with the help of environment variables. There are two ways to restrict the deployment with <code>tic</code> and environment variables:</p>
<ol style="list-style-type: decimal">
<li>Setting the condition in <code>tic.R</code>
</li>
<li>Setting the condition directly in <code>.travis.yml</code> in the “deploy” section</li>
</ol>
<p>Sometimes, env variables are implicitly set, e.g. when testing on multiple R versions (see example 2) (or by Travis itself, see <a href="advanced.html#travis-ci-meta-information">Travis CI Meta-Information</a>). There is no practical difference between both approaches. However, conditioning like shown here does only work for the “deploy” stage in <code>.travis.yml</code>. For <a href="advanced.html#running-stages-conditionally">conditioning other stages</a>, you need to use the <code>tic</code> approach.</p>
<p>In the following we prepared an example for each option:</p>
<ol style="list-style-type: decimal">
<li>Specifically set the env variable <code>BUILD_PKGDOWN</code> in <code>.travis.yml</code> and add the condition in <code>tic.R</code> to only run the deploy stage when this env variable evaluates to TRUE:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="fu">jobs:</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="fu">include:</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="kw">-</span> <span class="fu">stage:</span><span class="at"> stage1</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">      <span class="fu">env:</span><span class="at"> BUILD_PKGDOWN=TRUE</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">      <span class="fu">before_install:</span><span class="at"> R -q -e 'install.packages("remotes"); remotes::install_github("ropenscilabs/tic"); tic::prepare_all_stages(); tic::before_install()'</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">      <span class="kw">[</span>...<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">      <span class="fu">deploy:</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">        <span class="fu">provider:</span><span class="at"> script</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">        <span class="fu">script:</span><span class="at"> R -q -e 'tic::deploy()'</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">        <span class="fu">on:</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">          <span class="fu">all_branches:</span><span class="at"> true</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">    <span class="kw">-</span> <span class="fu">stage:</span><span class="at"> stage2</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">      <span class="fu">before_install:</span><span class="at"> R -q -e 'install.packages("remotes"); remotes::install_github("ropenscilabs/tic"); tic::prepare_all_stages(); tic::before_install()'</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">      <span class="kw">[</span>...<span class="kw">]</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">      <span class="fu">deploy:</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">        <span class="fu">provider:</span><span class="at"> script</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">        <span class="fu">script:</span><span class="at"> R -q -e 'tic::deploy()'</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">        <span class="fu">on:</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">          <span class="fu">all_branches:</span><span class="at"> true</span></a></code></pre></div>
<p><code>tic.R</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">Sys.getenv</span>(<span class="st">"id_rsa"</span>) <span class="op">!=</span><span class="st"> ""</span>) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="cf">if</span> (<span class="kw">Sys.getenv</span>(<span class="st">"BUILD_PKGDOWN"</span>) <span class="op">!=</span><span class="st"> ""</span>) {</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_build_pkgdown.html">step_build_pkgdown</a></span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>())</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">}</a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Setting the condition directly in <code>.travis.yml</code> in the “deploy” section:</li>
</ol>
<p>This can be useful when you run a build matrix which tests multiple R versions that has the same workflow for every job:</p>
<pre><code>r:
  - release
  - devel
  - oldrel</code></pre>
<p>Here we restrict the deployment on three conditions:</p>
<ul>
<li>No Pull Request</li>
<li>No CRON job (<a href="https://docs.travis-ci.com/user/cron-jobs/">CRON jobs</a> are builds that are started automatically after no build was triggered after a specific time)</li>
<li>Only for builds that use the R “devel” version</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="fu">deploy:</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">   <span class="fu">provider:</span><span class="at"> script</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">   <span class="fu">script:</span><span class="at"> R -q -e 'tic::deploy()'</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">   <span class="fu">on:</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">     <span class="fu">branch:</span><span class="at"> master</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">     <span class="fu">condition:</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">       <span class="kw">-</span> $TRAVIS_PULL_REQUEST = false</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">       <span class="kw">-</span> $TRAVIS_EVENT_TYPE != cron</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">       <span class="kw">-</span> $TRAVIS_R_VERSION_STRING = devel</a></code></pre></div>
<p>The same could optionally also be specified in <code>tic.R</code>. There is no difference between the two approaches:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">Sys.getenv</span>(<span class="st">"BUILD_PKGDOWN"</span>) <span class="op">!=</span><span class="st"> ""</span> <span class="op">&amp;&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw">Sys.getenv</span>(<span class="st">"TRAVIS_EVENT_TYPE"</span>) <span class="op">!=</span><span class="st"> "cron"</span> <span class="op">&amp;&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">    </span><span class="kw">Sys.getenv</span>(<span class="st">"TRAVIS_R_VERSION_STRING"</span>) <span class="op">==</span><span class="st"> "devel"</span>) {</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_build_pkgdown.html">step_build_pkgdown</a></span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>())</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">}</a></code></pre></div>
</div>
<div id="committing-single-files" class="section level2">
<h2 class="hasAnchor">
<a href="#committing-single-files" class="anchor"></a>Committing single files</h2>
<p>Function <code><a href="../reference/step_push_deploy.html">step_push_deploy()</a></code> has the ability to only commit and push single files if they have changed during a CI build. This can be very useful for conditionally pushing documentation files like <code>NEWS</code> or <code>man/</code> and <code>NAMESPACE</code> if these are automatically created via Travis. First, you need to make sure these files are created correctly by calling <code><a href="http://www.rdocumentation.org/packages/devtools/topics/document">devtools::document()</a></code>. Then, simply add the desired paths to argument <code>commit_paths</code> in <code><a href="../reference/step_push_deploy.html">step_push_deploy()</a></code> and push to your desired branch (here <code>master</code>):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_code_step</a></span>(devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/document">document</a></span>(<span class="dt">roclets=</span><span class="kw">c</span>(<span class="st">'rd'</span>, <span class="st">'collate'</span>, <span class="st">'namespace'</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>(<span class="dt">orphan =</span> <span class="ot">FALSE</span>, <span class="dt">branch =</span> <span class="st">"master"</span>, </a>
<a class="sourceLine" id="cb6-7" data-line-number="7">                              <span class="dt">commit_paths =</span> <span class="kw">c</span>(<span class="st">"NAMESPACE"</span>, <span class="st">"man/*"</span>)))</a></code></pre></div>
<p>Applying this idea of course depends on your overall R package development strategy: Commit files like <code>/man/</code> and <code>NS</code> directly or let them be created by Travis? An example project that uses the latter strategy is <a href="https://github.com/mlr-org/mlrng/blob/master/tic.R">mlr</a>.</p>
</div>
</div>
<div id="running-stages-conditionally" class="section level1">
<h1 class="hasAnchor">
<a href="#running-stages-conditionally" class="anchor"></a>Running stages conditionally</h1>
<p>As introduced in the <a href="advanced.html#deployment">prior section</a>, conditioning of commands is based on env variables. The most common use case is the testing on multiple R versions but if you test on multiple CI services you may also want to only run certain tasks on one of them. We already explained <a href="advanced.html#pkgdown-deployment">how to do so</a> if you are deploying a<code>pkgdown</code> site.</p>
<p>Another task is the code coverage generation. You do not want to run this on every R version as the outcome will always be the same. Also it increases the build time on every build which is not what you want! So, it is sufficient to just run it on one R version, e.g. “release”. When you use multiple R versions, Travis automatically sets up a build matrix with each build having <a href="https://docs.travis-ci.com/user/languages/r/#Environment-Variables">set an environmental variable for the R version</a> used. So all you need to do is to condition the stage execution on this env variable:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">Sys.getenv</span>(<span class="st">"TRAVIS_R_VERSION"</span>) <span class="op">==</span><span class="st"> "release"</span>) {</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"after_success"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(covr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/covr/topics/codecov">codecov</a></span>())</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">}</a></code></pre></div>
<p>Note that setting the <code>after_success</code> stage explicitly will overwrite what <code><a href="../reference/DSL.html">add_package_checks()</a></code> would do in the background for this particular stage (which is what you want if you define the step on your own).</p>
<p>Another condition that comes in handy is to run certain stages only on Travis CI (e.g. the code coverage step):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">inherits</span>(<span class="kw"><a href="../reference/ci.html">ci</a></span>(), <span class="st">"TravisCI"</span>) {</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"after_success"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(covr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/covr/topics/codecov">codecov</a></span>())</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">}</a></code></pre></div>
</div>
<div id="installing-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#installing-packages" class="anchor"></a>Installing packages</h1>
<div id="github-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#github-packages" class="anchor"></a>Github packages</h2>
<p>Github packages should be installed in the <code>install</code> stage:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"install"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/DSL.html">add_code_step</a></span>(<span class="kw">step_install_github</span>(<span class="st">"r-lib/rcmdcheck"</span>))</a></code></pre></div>
<p>Note that the underlying <code><a href="http://www.rdocumentation.org/packages/remotes/topics/install_github">remotes::install_github()</a></code> is vectorized for the <code>repo</code> argument which means you can pass all packages you want to install in a single function call: <code>add_code_step(step_install_github(c("r-lib/rcmdcheck", "r-lib/usethis"))</code>.</p>
</div>
<div id="cran-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#cran-packages" class="anchor"></a>CRAN packages</h2>
<p>Sometimes you need to install CRAN packages that are not specified in the DESCRIPTION file of your package. For example, to create a favicon in <code>pkgdown</code>, the <code>magick</code> package is required. To install the package (only if it does not exist in the cache already), run the following:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"install"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/DSL.html">add_code_step</a></span>(<span class="kw">step_install_cran</span>(<span class="st">"magick"</span>))</a></code></pre></div>
</div>
</div>
<div id="travis-ci-meta-information" class="section level1">
<h1 class="hasAnchor">
<a href="#travis-ci-meta-information" class="anchor"></a>Travis CI Meta-Information</h1>
<p>The <code><a href="../reference/ci.html">ci()</a></code> function holds valuable information about the CI system. It can be used to query information that can be again be utilized for conditioning stages or steps.</p>
<p>For example, the user may wish to only deploy on Travis by using <code>inherits(ci(), "TravisCI")</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">inherits</span>(<span class="kw"><a href="../reference/ci.html">ci</a></span>(), <span class="st">"TravisCI"</span>)) {</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="kw"><a href="../reference/DSL.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/DSL.html">add_step</a></span>(<span class="kw"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>())</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">}</a></code></pre></div>
<p>See <code><a href="../reference/ci.html">?ci</a></code> for more information on which information can be extracted from this function.</p>
</div>
<div id="troubleshooting-running-tic-locally" class="section level1">
<h1 class="hasAnchor">
<a href="#troubleshooting-running-tic-locally" class="anchor"></a>Troubleshooting: Running tic locally</h1>
<p>You can run <code>tic</code> locally by using <code><a href="../reference/load_from_file.html">load_from_file()</a></code>. This function sources your <code>tic.R</code> file and reports eventual problems.</p>
<p>To emulate a CI run locally, you can simply call <code><a href="../reference/tic.html">tic()</a></code> and the stages and steps will be executed in your local R console. Note that doing this will use your local system libraries and not the Travis environment.</p>
</div>
<div id="troubleshooting-entering-the-ci-build" class="section level1">
<h1 class="hasAnchor">
<a href="#troubleshooting-entering-the-ci-build" class="anchor"></a>Troubleshooting: Entering the CI build</h1>
<p>If your Travis build fails and you have no clue why (error messages are too unspecific, you cannot reproduce the problem locally), you can enter into the Travis build via <code>ssh</code>. To do so, your repository must be <a href="https://docs.travis-ci.com/user/running-build-in-debug-mode/#enabling-debug-mode">opt-in</a> for “ssh debugging”.</p>
<p>Afterwards, you can simply call <code>travis::travis_debug_job(&lt;jobID&gt;)</code> and the build will restart.</p>
<p>Wait a few minutes until the build arrives at the point when it prints you the <code>ssh</code> command you can use to log in. It should look similar to <code>ssh ukjiuCEkxBBnRAe32Y8xCH0zj@ny2.tmate.io</code>.</p>
<p>Once you are in the build <a href="https://docs.travis-ci.com/user/running-build-in-debug-mode/#Things-to-do-once-you-are-inside-the-debug-VM">check</a> these handy functions to execute specific stages.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#deployment">Deployment</a><ul class="nav nav-pills nav-stacked">
<li><a href="#pkgdown-deployment">pkgdown deployment</a></li>
      <li><a href="#committing-single-files">Committing single files</a></li>
      </ul>
</li>
      <li><a href="#running-stages-conditionally">Running stages conditionally</a></li>
      <li>
<a href="#installing-packages">Installing packages</a><ul class="nav nav-pills nav-stacked">
<li><a href="#github-packages">Github packages</a></li>
      <li><a href="#cran-packages">CRAN packages</a></li>
      </ul>
</li>
      <li><a href="#travis-ci-meta-information">Travis CI Meta-Information</a></li>
      <li><a href="#troubleshooting-running-tic-locally">Troubleshooting: Running tic locally</a></li>
      <li><a href="#troubleshooting-entering-the-ci-build">Troubleshooting: Entering the CI build</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Kirill Müller, Mika Braginsky, Karthik Ram, Jeroen Ooms, Patrick Schratz, rOpenSci.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
